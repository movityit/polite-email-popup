!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("stormcloud"),require("tigerlily")):"function"==typeof define&&define.amd?define(["stormcloud","tigerlily"],t):(e=e||self).politeEmailPopup=t(e.stormcloud,e.tigerlily)}(this,function(e,t){t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var n={},o={};function i(e){return o[e]||document.querySelector(e)}function a(e,t){var n=localStorage.getItem("an-awesome-localstorage-db"),o=n?JSON.parse(n):{};return o[e]=t,localStorage.setItem("an-awesome-localstorage-db",JSON.stringify(o)),t}function r(e){return(localStorage.getItem("an-awesome-localstorage-db")?JSON.parse(localStorage.getItem("an-awesome-localstorage-db")):{})[e]}t("polite-email-popup");var l={set:a,get:r,increment:function(e){var t=r(e)||0;return a(e,++t),t}},d=function(e,t){var n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)},c=function(e,t){document.addEventListener(e,function(e){t(e.detail)},!1)},s={WEBSITE_TYPES:{CONTENT:"CONTENT",MARKETING:"MARKETING"},FOCUSABLE_SELECTORS:"a[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), *[tabindex]",IS_MOBILE:window.matchMedia("only screen and (max-width: 780px)").matches,MODAL_ELEM_SELECTOR:".email-modal",MODAL_ELEM_FORM_SELECTOR:".email-modal__content",MODAL_ELEM_CLOSE_BUTTON_SELECTOR:".email-modal__close",BODY_CLASS_MODAL_OPEN:"email-modal-is-open",MODAL_IS_OPENABLE:!1,SITE_PAGE_VIEWS:0,HIGHEST_SCROLL_PERCENTAGE:0,ACTIVE_TIME_ON_SITE:0,ACTIVE_TIME_ON_PAGE:0,setActiveElement:function(e){this.activeElement=e},getActiveElement:function(){return this.activeElement},setModalAsOpenable:function(){this.MODAL_IS_OPENABLE=!0,d("MODAL_IS_OPENABLE",!0)},isModalOpenable:function(){return this.MODAL_IS_OPENABLE},getHighestScrollPercentage:function(){return this.HIGHEST_SCROLL_PERCENTAGE},getActiveTimeOnSite:function(){return this.ACTIVE_TIME_ON_SITE},getActiveTimeOnPage:function(){return this.ACTIVE_TIME_ON_PAGE},incrementSitePageViews:function(){var e=l.increment("pageViews");this.SITE_PAGE_VIEWS=e,d("pageData",{pageViews:e})},setHighestScrollPercentage:function(e){var t=l.get("highestScrollPercentage")||0,n=e>t?e:t;l.set("highestScrollPercentage",n),this.HIGHEST_SCROLL_PERCENTAGE=n,d("pageData",{highestScrollPercentage:n})},incrementActiveTimeOnSite:function(e){var t=l.increment("activeTimeOnSite");this.ACTIVE_TIME_ON_SITE=t,d("pageData",{activeTimeOnSite:t})},incrementActiveTimeOnPage:function(e){this.ACTIVE_TIME_ON_PAGE+=1,d("pageData",{activeTimeOnPage:this.ACTIVE_TIME_ON_PAGE})}},u=e.throttle(1e3,function(){var e,t;s.setHighestScrollPercentage((e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),t=window.pageYOffset/(e-document.documentElement.clientHeight),Math.floor(100*t))),s.incrementActiveTimeOnSite(),s.incrementActiveTimeOnPage()});function m(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var E=!1;if("undefined"!=typeof window){var v={get passive(){E=!0}};window.addEventListener("testPassive",null,v),window.removeEventListener("testPassive",null,v)}var g="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1),T=[],S=!1,_=-1,f=void 0,O=void 0,b=function(e){return T.some(function(t){return!(!t.options.allowTouchMove||!t.options.allowTouchMove(e))})},A=function(e){var t=e||window.event;return!!b(t.target)||t.touches.length>1||(t.preventDefault&&t.preventDefault(),!1)};function p(){document.body.classList.remove(s.BODY_CLASS_MODAL_OPEN),s.modalElem.style.display="none",document.querySelectorAll(s.FOCUSABLE_SELECTORS).forEach(function(e){return e.removeAttribute("tabindex")}),document.querySelectorAll("body > [aria-hidden]").forEach(function(e){return e.removeAttribute("aria-hidden")}),s.modalElem.setAttribute("aria-hidden","true");var e=s.getActiveElement();e&&e.focus(),function(e){if(g){if(!e)return void console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");e.ontouchstart=null,e.ontouchmove=null,T=T.filter(function(t){return t.targetElement!==e}),S&&0===T.length&&(document.removeEventListener("touchmove",A,E?{passive:!1}:void 0),S=!1)}else(T=T.filter(function(t){return t.targetElement!==e})).length||setTimeout(function(){void 0!==O&&(document.body.style.paddingRight=O,O=void 0),void 0!==f&&(document.body.style.overflow=f,f=void 0)})}(s.modalElem)}var h=["pageViews","highestScrollPercentage","activeTimeOnSite","activeTimeOnPage"],L={pageViews:"",highestScrollPercentage:"%",activeTimeOnSite:"s",activeTimeOnPage:"s"};function y(e){var t,o=e.showDebugNotice,a=void 0!==o&&o,r=e.websiteType,l=e.beSlightlyMoreAggressive,d=void 0!==l&&l,v=e.onSubmit,y=void 0===v?function(){}:v,I=e.imageSrc,M=void 0===I?"":I,w=e.headingText,C=void 0===w?"Sign up for updates":w,P=e.descriptionText,N=void 0===P?"Get cutting edge articles and insights into our process":P,B=e.mainButtonText,D=void 0===B?"Sign up":B,x=e.closeButtonText,R=void 0===x?"Close":x;t=function(){var e,t;e={showDebugNotice:a,websiteType:r,beSlightlyMoreAggressive:d,imageSrc:M,headingText:C,descriptionText:N,mainButtonText:D,closeButtonText:R},Object.keys(e).forEach(function(t){n[t]=e[t]}),Object.assign(n,{WEBSITE_TYPES:{CONTENT:"CONTENT",MARKETING:"MARKETING"},IS_MOBILE:window.matchMedia("only screen and (max-width: 780px)").matches,FOCUSABLE_SELECTORS:"a[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), *[tabindex]",BODY_CLASS_MODAL_OPEN:"email-modal-is-open",MODAL_ELEM:i(".email-modal"),MODAL_FORM_ELEM:i(".email-modal__content"),MODAL_CLOSE_BUTTON_ELEM:i(".email-modal__close")}),function(e){var t=(void 0).imageSrc,n=(void 0).headingText,o=(void 0).descriptionText,i=(void 0).mainButtonText;(void 0).showDebugNotice&&document.body.insertAdjacentHTML("beforeend",'<div class="debug-emails-forms">\n    <div>\n      <b>Page views: </b><span data-event-name="pageViews">0</span>\n    </div>\n    <div>\n      <b>Scroll percentage: </b><span data-event-name="highestScrollPercentage">0%</span>\n    </div>\n    <div>\n      <b>Time on site: </b><span data-event-name="activeTimeOnSite">0s</span>\n    </div>\n    <div>\n      <b>Time on page: </b><span data-event-name="activeTimeOnPage">0s</span>\n    </div>\n    <div>\n      <b>Saw modal: </b><span>never</span>\n    </div>\n    <div>\n      <b>Closed modal: </b><span>never</span>\n    </div>\n    <div>\n      <b>Closed bottom bar: </b><span>never</span>\n    </div>\n    <div>\n      <b>Modal is openable: </b><span data-event-name="modalIsOpenable">false</span>\n    </div>\n    <button class="debug-emails-forms__reset" type="button">Reset</button>\n  </div>');var a=getTemplateString({imageSrc:t,headingText:n,descriptionText:o,mainButtonText:i});document.body.insertAdjacentHTML("beforeend",a)}(),a&&(c("pageData",function(e){var t=h.find(function(t){return e.hasOwnProperty(t)}),n=e[t]+L[t];document.querySelector(".debug-emails-forms [data-event-name='"+t+"']").innerText=n}),c("MODAL_IS_OPENABLE",function(e){document.querySelector(".debug-emails-forms [data-event-name='modalIsOpenable']").innerText=e?"true":"false"}),document.querySelector(".debug-emails-forms__reset").addEventListener("click",function(e){window.localStorage.clear(),window.location.reload()})),function(e){var t=e.onSubmit;globals.modalElem=document.querySelector(globals.MODAL_ELEM_CLASS),globals.modalElemForm=document.querySelector(globals.MODAL_ELEM_FORM_CLASS),globals.modalElemCloseButton=document.querySelector(globals.MODAL_ELEM_CLOSE_BUTTON_CLASS),globals.onSubmit=t,s.modalElem.addEventListener("click",function(e){({event:e}).event.target.closest(s.MODAL_ELEM_FORM_CLASS)||p()}),s.modalElemForm.addEventListener("submit",function(e){return function(e){var t=e.event;t.preventDefault();var n=t.currentTarget.querySelector(".email-signup-form-input");s.onSubmit({event:t,email:n.value}),p()}({event:e})}),s.modalElemCloseButton.addEventListener("click",function(){return p()}),document.addEventListener("keydown",function(e){27==={event:e}.event.keyCode&&document.body.classList.contains(s.BODY_CLASS_MODAL_OPEN)&&p()})}({onSubmit:y,imageSrc:M,headingText:C,descriptionText:N,mainButtonText:D}),s.incrementSitePageViews(),window.addEventListener("scroll",u),function(e){var t=e.websiteType,n=e.beSlightlyMoreAggressive;c("pageData",function(e){var o=function(e){var t=e.websiteType,n=e.beSlightlyMoreAggressive;return t===s.WEBSITE_TYPES.CONTENT?n?{ACTIVE_TIME_ON_PAGE:6,ACTIVE_TIME_ON_SITE:20,HIGHEST_SCROLL_PERCENTAGE:25}:{ACTIVE_TIME_ON_PAGE:8,ACTIVE_TIME_ON_SITE:30,HIGHEST_SCROLL_PERCENTAGE:35}:t===s.WEBSITE_TYPES.MARKETING?n?{ACTIVE_TIME_ON_PAGE:6,SITE_PAGE_VIEWS:2,ACTIVE_TIME_ON_SITE:20}:{ACTIVE_TIME_ON_PAGE:8,SITE_PAGE_VIEWS:3,ACTIVE_TIME_ON_SITE:30}:void 0}({websiteType:t,beSlightlyMoreAggressive:n});Object.keys(o).every(function(e){return s[e]>=o[e]})&&s.setModalAsOpenable()})}({websiteType:r,beSlightlyMoreAggressive:d}),t=function(){s.isModalOpenable()&&function(){s.setActiveElement(document.activeElement),s.modalElem.style.display="flex",document.body.classList.add(s.BODY_CLASS_MODAL_OPEN),s.modalElem.querySelector(s.FOCUSABLE_SELECTORS).focus();var e=document.querySelectorAll(s.FOCUSABLE_SELECTORS),t=s.modalElem.querySelectorAll(s.FOCUSABLE_SELECTORS),n=Array.from(t);e.forEach(function(e){n.includes(e)||e.setAttribute("tabindex","-1")}),s.modalElem.removeAttribute("aria-hidden"),Array.from(document.body.children).forEach(function(e){e!==s.modalElem&&e.setAttribute("aria-hidden","true")}),function(e,t){if(g){if(!e)return void console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");if(e&&!T.some(function(t){return t.targetElement===e})){var n={targetElement:e,options:{}};T=[].concat(m(T),[n]),e.ontouchstart=function(e){1===e.targetTouches.length&&(_=e.targetTouches[0].clientY)},e.ontouchmove=function(t){1===t.targetTouches.length&&function(e,t){var n=e.targetTouches[0].clientY-_;!b(e.target)&&(t&&0===t.scrollTop&&n>0||function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight}(t)&&n<0?A(e):e.stopPropagation())}(t,e)},S||(document.addEventListener("touchmove",A,E?{passive:!1}:void 0),S=!0)}}else{setTimeout(function(){void 0===O&&(window,document),void 0===f&&(f=document.body.style.overflow,document.body.style.overflow="hidden")});var o={targetElement:e,options:{}};T=[].concat(m(T),[o])}}(s.modalElem)}()},document.addEventListener("mouseout",function(e){var n=e.clientY<20,o=null===e.relatedTarget,i="select"!==e.target.nodeName.toLowerCase()&&"input"!==e.target.nodeName.toLowerCase();n&&o&&i&&t&&t()})},"loading"!=document.readyState?t():document.addEventListener("DOMContentLoaded",t)}return{contentWebsite:function(e){e.websiteType=s.WEBSITE_TYPES.CONTENT,y(e)},marketingWebsite:function(e){e.websiteType=s.WEBSITE_TYPES.MARKETING,y(e)}}});
//# sourceMappingURL=polite-email-popup.umd.js.map
