{"version":3,"file":"polite-email-popup.umd.js","sources":["../src/temporary-globals/temporary-globals.js","../src/helpers/get-elem.js","../src/temporary-globals/init-temporary-globals.js","../node_modules/tigerlily/dist/tigerlily.module.js","../src/helpers/localstorage-db.js","../src/helpers/persistent-globals.js","../src/helpers/mini-events.js","../src/helpers/globals.js","../src/helpers/init-data-watchers.js","../node_modules/stormcloud/dist/stormcloud.module.js","../node_modules/body-scroll-lock/lib/bodyScrollLock.mjs","../src/modal/close-modal.js","../src/helpers/init-debug-notice.js","../src/init-email-forms.js","../src/helpers/dom-ready.js","../src/helpers/on-exit-intent.js","../src/helpers/init-dom-elements.js","../src/debug-notice/add-debug-notice-html-to-page.js","../src/modal/init-modal.js","../src/modal/init-modal-event-listeners.js","../src/modal/init-modal-data-watchers.js","../src/modal/get-trigger-options.js","../src/modal/open-modal.js","../src/index.js"],"sourcesContent":["export default {};","let cache = {};\n// caches result of getting an element\nexport default function getElem (selector) {\n  return cache[selector] || document.querySelector(selector);\n}","import temporaryGlobals from \"./temporary-globals\";\nimport getElem from \"../helpers/get-elem\";\n\nwindow.temporaryGlobals = temporaryGlobals;\n\nconst selectors = {\n  MODAL_ELEM_SELECTOR: '.email-modal',\n  MODAL_FORM_ELEM_SELECTOR: '.email-modal__content',\n  MODAL_CLOSE_BUTTON_ELEM_SELECTOR: '.email-modal__close',\n};\n\nexport default function initTemporaryGlobals (userDefinedGlobals) {\n  console.log(12312312312313213);\n  Object.keys(userDefinedGlobals).forEach(key => {\n    temporaryGlobals[key] = userDefinedGlobals[key]\n  });\n\n  Object.assign(temporaryGlobals, {\n    WEBSITE_TYPES: {\n      CONTENT: \"CONTENT\",\n      MARKETING: \"MARKETING\"\n    },\n    IS_MOBILE: window.matchMedia(\"only screen and (max-width: 780px)\").matches,\n    FOCUSABLE_SELECTORS: 'a[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), *[tabindex]',\n    BODY_CLASS_MODAL_OPEN: 'email-modal-is-open',\n    MODAL_ELEM: getElem(selectors.MODAL_ELEM_SELECTOR),\n    MODAL_FORM_ELEM: getElem(selectors.MODAL_FORM_ELEM_SELECTOR),\n    MODAL_CLOSE_BUTTON_ELEM: getElem(selectors.MODAL_CLOSE_BUTTON_ELEM_SELECTOR)\n  });\n}\n\n\n","var t,n,r=Object.prototype,e=Function.prototype.toString,o=r.hasOwnProperty,a=e.call(Object),i=r.toString,u=(t=Object.getPrototypeOf,n=Object,function(r){return t(n(r))});function c(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function l(t,n){var r;if(\"undefined\"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,n){if(t){if(\"string\"==typeof t)return c(t,void 0);var r=Object.prototype.toString.call(t).slice(8,-1);return\"Object\"===r&&t.constructor&&(r=t.constructor.name),\"Map\"===r||\"Set\"===r?Array.from(t):\"Arguments\"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,void 0):void 0}}(t))||n&&t&&\"number\"==typeof t.length){r&&(t=r);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}return(r=t[Symbol.iterator]()).next.bind(r)}function f(){this.callbacksLookup={}}f.prototype={emit:function(t,n){for(var r,e=this.callbacksLookup[\"*\"]||[],o=l(this.callbacksLookup[t]||[]);!(r=o()).done;)(0,r.value)({name:t,value:n});for(var a,i=l(e);!(a=i()).done;)(0,a.value)({name:t,value:n})},on:function(t,n){for(var r,e=l(Array.isArray(t)?t:[t]);!(r=e()).done;){var o=r.value;this.callbacksLookup[o]||(this.callbacksLookup[o]=[]),this.callbacksLookup[o].push(n)}}};var s=new f;function p(t,n){void 0===n&&(n={}),t=t||\"tigerlily\";var r=n.defaults,c=void 0===r?{}:r,l=JSON.parse(localStorage.getItem(t)||\"{}\",b);return l=Object.assign(c,l),new Proxy(l,function n(r){return{get:function(t,e){return y(t[e])?new Proxy(t[e],n(r)):t[e]},set:function(n,c,l){n[c]=l,localStorage.setItem(t,JSON.stringify(r,v));var f=n[c],p=y(f)?JSON.parse(JSON.stringify(f,v),b):f,d=y(l)?JSON.parse(JSON.stringify(l,v),b):l,g=function(t,n){if(t===n)return\"\";var r=\"\";return function t(n,r,c){c=c||\"\",Array.isArray(n)?function(n,r,e){n.forEach((n,o,a)=>{const i=`${e}[${o}]`;r.call(a,n,o,a,i),t(a[o],r,i)})}(n,r,c):function(t){if(!function(t){return!!t&&\"object\"==typeof t}(t)||\"[object Object]\"!=i.call(t)||function(t){var n=!1;if(null!=t&&\"function\"!=typeof t.toString)try{n=!!(t+\"\")}catch(t){}return n}(t))return!1;var n=u(t);if(null===n)return!0;var r=o.call(n,\"constructor\")&&n.constructor;return\"function\"==typeof r&&r instanceof r&&e.call(r)==a}(n)&&function(n,r,e){for(const o in n){const a=e?`${e}.${o}`:o;r.call(n,n[o],o,n,a),t(n[o],r,a)}}(n,r,c)}(t,function(t,e,o,a){t===n&&(r=a)}),r}(r,l)||c;return s.emit(g,{prop:c,path:g,oldValue:p,value:d}),!0}}}(l))}function y(t){return\"object\"==typeof t&&null!==t&&!(t instanceof Date)}function v(t,n){if(this[t]instanceof Date){var r=this[t].getTime();return r?{__isDate:!0,ms:r}:void 0}return n}function b(t,n){return n.__isDate?new Date(n.ms):n}p.on=function(t,n){s.on(t,function(t){n(t.value)})};export default p;\n//# sourceMappingURL=tigerlily.module.js.map\n","// simple localStorage database\nfunction set (itemName, itemValue) {\n  let databaseString = localStorage.getItem(\"an-awesome-localstorage-db\");\n  let databaseObject = databaseString ? JSON.parse(databaseString) : {};\n  databaseObject[itemName] = itemValue;\n  localStorage.setItem(\"an-awesome-localstorage-db\", JSON.stringify(databaseObject));\n  return itemValue;\n}\n\nfunction get (itemName) {\n  let databaseString = localStorage.getItem(\"an-awesome-localstorage-db\");\n  let databaseObject = databaseString ? JSON.parse(localStorage.getItem(\"an-awesome-localstorage-db\")) : {};\n  return databaseObject[itemName];\n}\n\nfunction increment (itemName) {\n  let num = get(itemName) || 0;\n  num++;\n  set(itemName, num);\n  return num;\n}\n\nexport default {\n  set,\n  get,\n  increment\n}\n","import tigerlily from \"tigerlily\";\n\nconst persistentGlobals = tigerlily('polite-email-popup');\n\nexport {tigerlily, persistentGlobals};","function trigger (name, value) {\n  let event = new CustomEvent(name, { detail: value });\n  document.dispatchEvent(event);\n}\n\nfunction listen (name, cb) {\n  document.addEventListener(name, function (event) {\n    cb(event.detail);\n  }, false);\n}\n\nexport default {\n  trigger,\n  listen\n}","import db from \"./localstorage-db\";\nimport MiniEvents from \"./mini-events\";\n\nexport default {\n  WEBSITE_TYPES: {\n    CONTENT: \"CONTENT\",\n    MARKETING: \"MARKETING\"\n  },\n  FOCUSABLE_SELECTORS: 'a[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), *[tabindex]',\n  IS_MOBILE: window.matchMedia(\"only screen and (max-width: 780px)\").matches,\n  MODAL_ELEM_SELECTOR: '.email-modal',\n  MODAL_ELEM_FORM_SELECTOR: '.email-modal__content',\n  MODAL_ELEM_CLOSE_BUTTON_SELECTOR: '.email-modal__close',\n  BODY_CLASS_MODAL_OPEN: 'email-modal-is-open',\n  MODAL_IS_OPENABLE: false,\n  SITE_PAGE_VIEWS: 0,\n  HIGHEST_SCROLL_PERCENTAGE: 0,\n  ACTIVE_TIME_ON_SITE: 0,\n  ACTIVE_TIME_ON_PAGE: 0,\n  // TODO:\n  // MODAL_VIEW_COUNT, \n  // CLOSED_MODAL_DATE, \n  // CLOSED_MODAL_IN_PAST_TWO_WEEKS, \n  // CLOSED_BOTTOM_BAR_DATE,\n  // CLOSED_BOTTOM_BAR_IN_PAST_TWO_WEEKS,\n  setActiveElement (el) {\n    this.activeElement = el;\n  },\n  getActiveElement () {\n    return this.activeElement;\n  },\n  setModalAsOpenable () {\n    this.MODAL_IS_OPENABLE = true;\n    MiniEvents.trigger(\"MODAL_IS_OPENABLE\", true);\n  },\n  isModalOpenable () {\n    return this.MODAL_IS_OPENABLE;\n  },\n  getHighestScrollPercentage () {\n    return this.HIGHEST_SCROLL_PERCENTAGE;\n  },\n  getActiveTimeOnSite () {\n    return this.ACTIVE_TIME_ON_SITE;\n  },\n  getActiveTimeOnPage () {\n    return this.ACTIVE_TIME_ON_PAGE;\n  },\n  incrementSitePageViews () {\n    let pageViews = db.increment(\"pageViews\");\n    this.SITE_PAGE_VIEWS = pageViews;\n\n    MiniEvents.trigger(\"pageData\", {pageViews});\n  },\n  setHighestScrollPercentage (num) {\n    let savedScrollPercentage = db.get(\"highestScrollPercentage\") || 0;\n\n    let highestScrollPercentage = num > savedScrollPercentage ? num : savedScrollPercentage;\n\n    db.set(\"highestScrollPercentage\", highestScrollPercentage);\n    this.HIGHEST_SCROLL_PERCENTAGE = highestScrollPercentage;\n\n    MiniEvents.trigger(\"pageData\", {highestScrollPercentage});\n  },\n  incrementActiveTimeOnSite (seconds) {\n    let activeTimeOnSite = db.increment(\"activeTimeOnSite\");\n    this.ACTIVE_TIME_ON_SITE = activeTimeOnSite;\n\n    MiniEvents.trigger(\"pageData\", {activeTimeOnSite});\n  },\n  incrementActiveTimeOnPage (seconds) {\n    this.ACTIVE_TIME_ON_PAGE += 1;\n    MiniEvents.trigger(\"pageData\", {activeTimeOnPage: this.ACTIVE_TIME_ON_PAGE});\n  }\n}\n\n\n\n\n\n","import {throttle} from \"stormcloud\";\nimport globals from \"./globals\";\n\nfunction getScrollPercentage () {\n  // get the scroll height of the document (https://javascript.info/size-and-scroll-window#width-height-of-the-document) \n  let docScrollHeight = Math.max(document.body.scrollHeight, document.documentElement.scrollHeight, document.body.offsetHeight, document.documentElement.offsetHeight, document.body.clientHeight, document.documentElement.clientHeight);\n  // calculate scroll percentage (subtract browser height since that's not actually scrollable)\n  let scrollPercentage = window.pageYOffset / (docScrollHeight - document.documentElement.clientHeight);\n  // calculate percentage\n  return Math.floor(scrollPercentage * 100);\n}\n\nlet setCurrentScrollPercentageThrottled = throttle(1000, function () {\n  // the following code will execute every time the user scrolls\n  // as well as after every second of that scroll\n\n  globals.setHighestScrollPercentage(getScrollPercentage());\n  globals.incrementActiveTimeOnSite();\n  globals.incrementActiveTimeOnPage();\n});\n\nexport default function initDataWatchers () {\n  globals.incrementSitePageViews();\n\n  window.addEventListener('scroll', setCurrentScrollPercentageThrottled);\n}\n\n\n\n\n\n\n\n","function n(n,t){var i=!0,o=!1;return function(){var c=arguments;o||(o=!0,setTimeout(function(){n.apply(void 0,[].slice.call(c)),o=!1},i?0:t),i=!1)}}function t(n,t){var i;return function(){var o=arguments;clearTimeout(i),i=setTimeout(function(){n.apply(void 0,[].slice.call(o))},t)}}export{t as debounce,n as throttle};\n//# sourceMappingURL=stormcloud.module.js.map\n","function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n// Older browsers don't support event options, feature detect it.\n\n// Adopted and modified solution from Bohdan Didukh (2017)\n// https://stackoverflow.com/questions/41594997/ios-10-safari-prevent-scrolling-behind-a-fixed-overlay-and-maintain-scroll-posi\n\nvar hasPassiveEvents = false;\nif (typeof window !== 'undefined') {\n  var passiveTestOptions = {\n    get passive() {\n      hasPassiveEvents = true;\n      return undefined;\n    }\n  };\n  window.addEventListener('testPassive', null, passiveTestOptions);\n  window.removeEventListener('testPassive', null, passiveTestOptions);\n}\n\nvar isIosDevice = typeof window !== 'undefined' && window.navigator && window.navigator.platform && (/iP(ad|hone|od)/.test(window.navigator.platform) || window.navigator.platform === 'MacIntel' && window.navigator.maxTouchPoints > 1);\n\n\nvar locks = [];\nvar documentListenerAdded = false;\nvar initialClientY = -1;\nvar previousBodyOverflowSetting = void 0;\nvar previousBodyPaddingRight = void 0;\n\n// returns true if `el` should be allowed to receive touchmove events.\nvar allowTouchMove = function allowTouchMove(el) {\n  return locks.some(function (lock) {\n    if (lock.options.allowTouchMove && lock.options.allowTouchMove(el)) {\n      return true;\n    }\n\n    return false;\n  });\n};\n\nvar preventDefault = function preventDefault(rawEvent) {\n  var e = rawEvent || window.event;\n\n  // For the case whereby consumers adds a touchmove event listener to document.\n  // Recall that we do document.addEventListener('touchmove', preventDefault, { passive: false })\n  // in disableBodyScroll - so if we provide this opportunity to allowTouchMove, then\n  // the touchmove event on document will break.\n  if (allowTouchMove(e.target)) {\n    return true;\n  }\n\n  // Do not prevent if the event has more than one touch (usually meaning this is a multi touch gesture like pinch to zoom).\n  if (e.touches.length > 1) return true;\n\n  if (e.preventDefault) e.preventDefault();\n\n  return false;\n};\n\nvar setOverflowHidden = function setOverflowHidden(options) {\n  // Setting overflow on body/documentElement synchronously in Desktop Safari slows down\n  // the responsiveness for some reason. Setting within a setTimeout fixes this.\n  setTimeout(function () {\n    // If previousBodyPaddingRight is already set, don't set it again.\n    if (previousBodyPaddingRight === undefined) {\n      var _reserveScrollBarGap = !!options && options.reserveScrollBarGap === true;\n      var scrollBarGap = window.innerWidth - document.documentElement.clientWidth;\n\n      if (_reserveScrollBarGap && scrollBarGap > 0) {\n        previousBodyPaddingRight = document.body.style.paddingRight;\n        document.body.style.paddingRight = scrollBarGap + 'px';\n      }\n    }\n\n    // If previousBodyOverflowSetting is already set, don't set it again.\n    if (previousBodyOverflowSetting === undefined) {\n      previousBodyOverflowSetting = document.body.style.overflow;\n      document.body.style.overflow = 'hidden';\n    }\n  });\n};\n\nvar restoreOverflowSetting = function restoreOverflowSetting() {\n  // Setting overflow on body/documentElement synchronously in Desktop Safari slows down\n  // the responsiveness for some reason. Setting within a setTimeout fixes this.\n  setTimeout(function () {\n    if (previousBodyPaddingRight !== undefined) {\n      document.body.style.paddingRight = previousBodyPaddingRight;\n\n      // Restore previousBodyPaddingRight to undefined so setOverflowHidden knows it\n      // can be set again.\n      previousBodyPaddingRight = undefined;\n    }\n\n    if (previousBodyOverflowSetting !== undefined) {\n      document.body.style.overflow = previousBodyOverflowSetting;\n\n      // Restore previousBodyOverflowSetting to undefined\n      // so setOverflowHidden knows it can be set again.\n      previousBodyOverflowSetting = undefined;\n    }\n  });\n};\n\n// https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight#Problems_and_solutions\nvar isTargetElementTotallyScrolled = function isTargetElementTotallyScrolled(targetElement) {\n  return targetElement ? targetElement.scrollHeight - targetElement.scrollTop <= targetElement.clientHeight : false;\n};\n\nvar handleScroll = function handleScroll(event, targetElement) {\n  var clientY = event.targetTouches[0].clientY - initialClientY;\n\n  if (allowTouchMove(event.target)) {\n    return false;\n  }\n\n  if (targetElement && targetElement.scrollTop === 0 && clientY > 0) {\n    // element is at the top of its scroll.\n    return preventDefault(event);\n  }\n\n  if (isTargetElementTotallyScrolled(targetElement) && clientY < 0) {\n    // element is at the bottom of its scroll.\n    return preventDefault(event);\n  }\n\n  event.stopPropagation();\n  return true;\n};\n\nexport var disableBodyScroll = function disableBodyScroll(targetElement, options) {\n  if (isIosDevice) {\n    // targetElement must be provided, and disableBodyScroll must not have been\n    // called on this targetElement before.\n    if (!targetElement) {\n      // eslint-disable-next-line no-console\n      console.error('disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.');\n      return;\n    }\n\n    if (targetElement && !locks.some(function (lock) {\n      return lock.targetElement === targetElement;\n    })) {\n      var lock = {\n        targetElement: targetElement,\n        options: options || {}\n      };\n\n      locks = [].concat(_toConsumableArray(locks), [lock]);\n\n      targetElement.ontouchstart = function (event) {\n        if (event.targetTouches.length === 1) {\n          // detect single touch.\n          initialClientY = event.targetTouches[0].clientY;\n        }\n      };\n      targetElement.ontouchmove = function (event) {\n        if (event.targetTouches.length === 1) {\n          // detect single touch.\n          handleScroll(event, targetElement);\n        }\n      };\n\n      if (!documentListenerAdded) {\n        document.addEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);\n        documentListenerAdded = true;\n      }\n    }\n  } else {\n    setOverflowHidden(options);\n    var _lock = {\n      targetElement: targetElement,\n      options: options || {}\n    };\n\n    locks = [].concat(_toConsumableArray(locks), [_lock]);\n  }\n};\n\nexport var clearAllBodyScrollLocks = function clearAllBodyScrollLocks() {\n  if (isIosDevice) {\n    // Clear all locks ontouchstart/ontouchmove handlers, and the references.\n    locks.forEach(function (lock) {\n      lock.targetElement.ontouchstart = null;\n      lock.targetElement.ontouchmove = null;\n    });\n\n    if (documentListenerAdded) {\n      document.removeEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);\n      documentListenerAdded = false;\n    }\n\n    locks = [];\n\n    // Reset initial clientY.\n    initialClientY = -1;\n  } else {\n    restoreOverflowSetting();\n    locks = [];\n  }\n};\n\nexport var enableBodyScroll = function enableBodyScroll(targetElement) {\n  if (isIosDevice) {\n    if (!targetElement) {\n      // eslint-disable-next-line no-console\n      console.error('enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.');\n      return;\n    }\n\n    targetElement.ontouchstart = null;\n    targetElement.ontouchmove = null;\n\n    locks = locks.filter(function (lock) {\n      return lock.targetElement !== targetElement;\n    });\n\n    if (documentListenerAdded && locks.length === 0) {\n      document.removeEventListener('touchmove', preventDefault, hasPassiveEvents ? { passive: false } : undefined);\n\n      documentListenerAdded = false;\n    }\n  } else {\n    locks = locks.filter(function (lock) {\n      return lock.targetElement !== targetElement;\n    });\n    if (!locks.length) {\n      restoreOverflowSetting();\n    }\n  }\n};\n\n","import { enableBodyScroll } from 'body-scroll-lock';\nimport globals from \"../helpers/globals\";\n\nexport default function closeModal() {\n  document.body.classList.remove(globals.BODY_CLASS_MODAL_OPEN);\n\n  // TODO: keep track of when the modal was closed\n  // setItemLocalStorage(\"modalClosedDate\", Date.now());\n\n  // hide the modal\n  globals.modalElem.style.display = 'none';\n\n  // Untrap the tab focus by removing tabindex=-1. You should restore previous values if an element had them.    \n  const focusableElements = document.querySelectorAll(globals.FOCUSABLE_SELECTORS);\n  focusableElements.forEach(el => el.removeAttribute('tabindex'));\n  \n  // Untrap screen reader focus\n  const topLevelElements = document.querySelectorAll(\"body > [aria-hidden]\");\n  topLevelElements.forEach(el => el.removeAttribute('aria-hidden'));\n  globals.modalElem.setAttribute('aria-hidden', 'true');\n  \n  // restore focus to the triggering element\n  let activeElement = globals.getActiveElement();\n  if (activeElement) {\n    activeElement.focus();\n  }\n\n  enableBodyScroll(globals.modalElem);\n}","import MiniEvents from \"./mini-events\";\n\nconst validDataEventTypes = [\"pageViews\", \"highestScrollPercentage\", \"activeTimeOnSite\", \"activeTimeOnPage\"];\nconst eventValueUnitLookup = {\n  pageViews: \"\",\n  highestScrollPercentage: \"%\",\n  activeTimeOnSite: \"s\",\n  activeTimeOnPage: \"s\"\n};\n\n\n\nexport default function initDebugNotice () {\n  MiniEvents.listen(\"pageData\", function (dataEvent) {\n    let eventName = validDataEventTypes.find(name => dataEvent.hasOwnProperty(name));\n    let eventValue = dataEvent[eventName] + eventValueUnitLookup[eventName];\n\n    let eventDebugElement = document.querySelector(`.debug-emails-forms [data-event-name='${eventName}']`);\n    eventDebugElement.innerText = eventValue;\n  });\n\n  MiniEvents.listen(\"MODAL_IS_OPENABLE\", function (isOpenable) {\n    let eventDebugElement = document.querySelector(`.debug-emails-forms [data-event-name='modalIsOpenable']`);\n    eventDebugElement.innerText = isOpenable ? \"true\" : \"false\";\n  });\n\n  // reset button\n  document.querySelector(\".debug-emails-forms__reset\").addEventListener(\"click\", e => {\n    window.localStorage.clear(); \n    window.location.reload();\n  });\n}","import {throttle} from \"stormcloud\";\nimport domReady from \"./helpers/dom-ready\";\n\nimport initTemporaryGlobals from \"./temporary-globals/init-temporary-globals\";\nimport initDomElements from \"./helpers/init-dom-elements\";\nimport initElementGlobals from \"./helpers/init-element-globals\";\n\n\nimport db from \"./helpers/localstorage-db\";\nimport onExitIntent from \"./helpers/on-exit-intent\";\nimport globals from \"./helpers/globals\";\nimport initDataWatchers from \"./helpers/init-data-watchers\";\nimport initModalDataWatchers from \"./modal/init-modal-data-watchers\";\nimport initModal from \"./modal/init-modal\";\nimport initDebugNotice from \"./helpers/init-debug-notice\";\nimport openModal from \"./modal/open-modal\";\n\nexport default function initEmailForms ({\n  showDebugNotice = false,\n  websiteType, // \"content\" or \"marketing\"\n  beSlightlyMoreAggressive = false,\n  onSubmit = () => {},\n  imageSrc = \"\",\n  headingText = \"Sign up for updates\",\n  descriptionText = \"Get cutting edge articles and insights into our process\",\n  mainButtonText = \"Sign up\",\n  closeButtonText = \"Close\"\n}) {\n\n  console.log(\"xxxx\");\n\n  domReady(() => {\n\n    initTemporaryGlobals({showDebugNotice, websiteType, beSlightlyMoreAggressive, imageSrc, headingText, descriptionText, mainButtonText, closeButtonText});\n\n    // add all HTML elements to the page\n    initDomElements();\n\n    // get all the elements we'll need and add them to the global data\n    initElementGlobals();\n\n    if (showDebugNotice) {\n      initDebugNotice();\n    }\n\n    // add modal HTML to page and keep track of relevant modal elements\n    initModal({onSubmit, imageSrc, headingText, descriptionText, mainButtonText});\n\n    // keeps track of scroll position, page views, time on site, etc.\n    initDataWatchers();\n\n    // listens to page data and determines if modal is openable\n    initModalDataWatchers({websiteType, beSlightlyMoreAggressive});\n\n    onExitIntent(function () {\n      if (globals.isModalOpenable()) {\n        openModal({imageSrc, headingText, descriptionText, mainButtonText, closeButtonText});\n      }\n    });\n\n  });\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","export default function domReady(fn) {\n  if (document.readyState != 'loading'){\n    fn();\n  } else {\n    document.addEventListener('DOMContentLoaded', fn);\n  }\n}","/*\n  Exit Intent\n  ===========\n  Triggers a callback whenever the user is about to leave the page\n\n  - Isn't aggressive\n    - Will only trigger once\n    - Will only trigger when the mouse is near top of page\n  - Addresses Firefox bugs with INPUT and SELECT elements\n*/\n\nexport default function onExitIntent (exitIntentCallback) {\n  function onMouseOut(event) {\n    let mouseNearTopOfPage = event.clientY < 20;\n    let mouseDidntEnterAnotherElement = event.relatedTarget === null;\n    let mouseEventIsNotInsideAnInputElement = event.target.nodeName.toLowerCase() !== \"select\" && event.target.nodeName.toLowerCase() !== \"input\"; \n\n    if (mouseNearTopOfPage && mouseDidntEnterAnotherElement && mouseEventIsNotInsideAnInputElement) {\n      // document.removeEventListener(\"mouseout\", onMouseOut);\n      if (exitIntentCallback) {\n        exitIntentCallback();\n      }\n    }\n  }\n  document.addEventListener(\"mouseout\", onMouseOut);\n}","import addDebugNoticeHtmlToPage from \"../debug-notice/add-debug-notice-html-to-page\";\nimport getModalTemplateString from \"../modal/get-modal-template-string\";\n\nexport default function initDomElements ({showDebugNotice, imageSrc, headingText, descriptionText, mainButtonText}) {\n  if (showDebugNotice) {\n    addDebugNoticeHtmlToPage();\n  }\n\n  // Add modal to page\n  let modalTemplateString = getTemplateString({imageSrc, headingText, descriptionText, mainButtonText});\n  document.body.insertAdjacentHTML(\"beforeend\", modalTemplateString);\n}","export default function addDebugNoticeHTMLToPage () {\n  const debugNoticeHtml = `<div class=\"debug-emails-forms\">\n    <div>\n      <b>Page views: </b><span data-event-name=\"pageViews\">0</span>\n    </div>\n    <div>\n      <b>Scroll percentage: </b><span data-event-name=\"highestScrollPercentage\">0%</span>\n    </div>\n    <div>\n      <b>Time on site: </b><span data-event-name=\"activeTimeOnSite\">0s</span>\n    </div>\n    <div>\n      <b>Time on page: </b><span data-event-name=\"activeTimeOnPage\">0s</span>\n    </div>\n    <div>\n      <b>Saw modal: </b><span>never</span>\n    </div>\n    <div>\n      <b>Closed modal: </b><span>never</span>\n    </div>\n    <div>\n      <b>Closed bottom bar: </b><span>never</span>\n    </div>\n    <div>\n      <b>Modal is openable: </b><span data-event-name=\"modalIsOpenable\">false</span>\n    </div>\n    <button class=\"debug-emails-forms__reset\" type=\"button\">Reset</button>\n  </div>`;\n\n  document.body.insertAdjacentHTML(\"beforeend\", debugNoticeHtml);\n}","import {persistentGlobals} from \"../helpers/persistent-globals\";\nimport initModalEventListeners from \"./init-modal-event-listeners\";\n\nexport default function initModal ({onSubmit, imageSrc, headingText, descriptionText, mainButtonText}) {\n  // Get modal elements\n  globals.modalElem = document.querySelector(globals.MODAL_ELEM_CLASS); // \"$('.some-class')\"\n  globals.modalElemForm = document.querySelector(globals.MODAL_ELEM_FORM_CLASS);\n  globals.modalElemCloseButton = document.querySelector(globals.MODAL_ELEM_CLOSE_BUTTON_CLASS);\n\n  // save onSubmit callback\n  globals.onSubmit = onSubmit;\n\n  initModalEventListeners();\n}","import globals from \"../helpers/globals\";\nimport closeModal from \"./close-modal\";\n\nexport default function initModalEventListeners () {\n  globals.modalElem.addEventListener(\"click\", event => onClickModalBackdrop({event}));\n  globals.modalElemForm.addEventListener(\"submit\", event => onSubmit({event}));\n  globals.modalElemCloseButton.addEventListener('click', () => closeModal());\n  document.addEventListener(\"keydown\", (event) => onKeyDown({event}));\n}\n\nfunction onKeyDown ({event}) {\n  if (event.keyCode === 27 && document.body.classList.contains(globals.BODY_CLASS_MODAL_OPEN)) {\n    closeModal();\n  }\n}\n\nfunction onSubmit ({event}) {\n  event.preventDefault();\n\n  // trigger onSubmit callback\n  let emailInputElement = event.currentTarget.querySelector(\".email-signup-form-input\");\n  let email = emailInputElement.value;\n  globals.onSubmit({event, email});\n\n  closeModal();\n}\n\nfunction onClickModalBackdrop ({event}) {\n  if (!event.target.closest(globals.MODAL_ELEM_FORM_CLASS)) {\n    closeModal();\n  }\n}\n\n","import globals from \"../helpers/globals\";\nimport MiniEvents from \"../helpers/mini-events\";\nimport getTriggerOptions from \"./get-trigger-options\";\n\nexport default function initModalDataWatchers ({websiteType, beSlightlyMoreAggressive}) {\n  MiniEvents.listen(\"pageData\", function (dataEvent) {\n    let triggerOptions = getTriggerOptions({websiteType, beSlightlyMoreAggressive});\n\n    let shouldShowModal = Object.keys(triggerOptions).every(triggerOptionKey => {\n      let minValue = triggerOptions[triggerOptionKey];\n      let actualValue = globals[triggerOptionKey];\n\n      return actualValue >= minValue;\n    });;\n\n    if (shouldShowModal) {\n      globals.setModalAsOpenable();\n    }\n  });\n}","import globals from \"../helpers/globals\";\n\nexport default function ({websiteType, beSlightlyMoreAggressive}) {\n  if (websiteType === globals.WEBSITE_TYPES.CONTENT) {\n    if (!beSlightlyMoreAggressive) {\n      // not aggressive\n      return {\n        ACTIVE_TIME_ON_PAGE: 8,\n        ACTIVE_TIME_ON_SITE: 30,\n        HIGHEST_SCROLL_PERCENTAGE: 35\n      };\n    } else {\n      // somewhat aggressive\n      return {\n        ACTIVE_TIME_ON_PAGE: 6,\n        ACTIVE_TIME_ON_SITE: 20,\n        HIGHEST_SCROLL_PERCENTAGE: 25\n      };\n    }\n  } else if (websiteType === globals.WEBSITE_TYPES.MARKETING) {\n    if (!beSlightlyMoreAggressive) {\n      // not aggressive\n      return {\n        ACTIVE_TIME_ON_PAGE: 8,\n        SITE_PAGE_VIEWS: 3,\n        ACTIVE_TIME_ON_SITE: 30\n      };\n    } else {\n      // somewhat aggressive\n      return {\n        ACTIVE_TIME_ON_PAGE: 6,\n        SITE_PAGE_VIEWS: 2,\n        ACTIVE_TIME_ON_SITE: 20\n      };\n    }\n  }\n}","import globals from \"../helpers/globals\";\nimport { disableBodyScroll } from 'body-scroll-lock';\n\nexport default function openModal() {\n  globals.setActiveElement(document.activeElement);\n\n  // show the modal\n  globals.modalElem.style.display = 'flex';\n  document.body.classList.add(globals.BODY_CLASS_MODAL_OPEN);\n  \n  // Focus the first element within the modal. Make sure the element is visible and doesnt have focus disabled (tabindex=-1);\n  globals.modalElem.querySelector(globals.FOCUSABLE_SELECTORS).focus();\n\n  // Trap the tab focus by disable tabbing on all elements outside of your modal.\n  // These elements need to be gotten at the time the modal is opened because they may have been added to the page dynamically\n  const focusableElements = document.querySelectorAll(globals.FOCUSABLE_SELECTORS);\n  const focusableElementsInModal = globals.modalElem.querySelectorAll(globals.FOCUSABLE_SELECTORS);\n  const focusableElementsInModalArray = Array.from(focusableElementsInModal);\n  focusableElements.forEach(el => {\n    if (!focusableElementsInModalArray.includes(el)) {\n      el.setAttribute('tabindex', '-1');\n    }\n  });\n\n  // Trap the screen reader focus as well with aria roles.\n  globals.modalElem.removeAttribute('aria-hidden');\n  const topLevelElements = Array.from(document.body.children);\n  topLevelElements.forEach(el => {\n    if (el !== globals.modalElem) {\n      el.setAttribute('aria-hidden', 'true');\n    }\n  });\n\n  disableBodyScroll(globals.modalElem);\n}","import initEmailForms from \"./init-email-forms\";\nimport globals from \"./helpers/globals\";\n\nfunction contentWebsite (options) {\n  options.websiteType = globals.WEBSITE_TYPES.CONTENT;\n  initEmailForms(options);\n}\n\nfunction marketingWebsite (options) {\n  options.websiteType = globals.WEBSITE_TYPES.MARKETING;\n  initEmailForms(options);\n}\n\nexport default {\n  contentWebsite,\n  marketingWebsite\n}"],"names":["cache","getElem","selector","document","querySelector","window","temporaryGlobals","t","n","r","Object","prototype","e","Function","toString","o","hasOwnProperty","a","call","i","u","getPrototypeOf","c","length","Array","l","Symbol","iterator","isArray","slice","constructor","name","from","test","done","value","TypeError","next","bind","f","this","callbacksLookup","emit","on","push","s","p","defaults","JSON","parse","localStorage","getItem","b","assign","Proxy","get","y","set","setItem","stringify","v","d","g","forEach","prop","path","oldValue","Date","getTime","__isDate","ms","itemName","itemValue","databaseString","databaseObject","tigerlily","increment","num","event","CustomEvent","detail","dispatchEvent","cb","addEventListener","WEBSITE_TYPES","CONTENT","MARKETING","FOCUSABLE_SELECTORS","IS_MOBILE","matchMedia","matches","MODAL_ELEM_SELECTOR","MODAL_ELEM_FORM_SELECTOR","MODAL_ELEM_CLOSE_BUTTON_SELECTOR","BODY_CLASS_MODAL_OPEN","MODAL_IS_OPENABLE","SITE_PAGE_VIEWS","HIGHEST_SCROLL_PERCENTAGE","ACTIVE_TIME_ON_SITE","ACTIVE_TIME_ON_PAGE","setActiveElement","el","activeElement","getActiveElement","setModalAsOpenable","MiniEvents","isModalOpenable","getHighestScrollPercentage","getActiveTimeOnSite","getActiveTimeOnPage","incrementSitePageViews","pageViews","db","setHighestScrollPercentage","savedScrollPercentage","highestScrollPercentage","incrementActiveTimeOnSite","seconds","activeTimeOnSite","incrementActiveTimeOnPage","activeTimeOnPage","setCurrentScrollPercentageThrottled","arguments","setTimeout","apply","throttle","docScrollHeight","scrollPercentage","globals","Math","max","body","scrollHeight","documentElement","offsetHeight","clientHeight","pageYOffset","floor","_toConsumableArray","arr","arr2","hasPassiveEvents","passiveTestOptions","passive","removeEventListener","isIosDevice","navigator","platform","maxTouchPoints","locks","documentListenerAdded","initialClientY","previousBodyOverflowSetting","previousBodyPaddingRight","allowTouchMove","some","lock","options","preventDefault","rawEvent","target","touches","closeModal","classList","remove","modalElem","style","display","querySelectorAll","removeAttribute","setAttribute","focus","targetElement","console","error","ontouchstart","ontouchmove","filter","undefined","paddingRight","overflow","enableBodyScroll","validDataEventTypes","eventValueUnitLookup","initEmailForms","fn","showDebugNotice","websiteType","beSlightlyMoreAggressive","onSubmit","imageSrc","headingText","descriptionText","mainButtonText","closeButtonText","log","userDefinedGlobals","exitIntentCallback","keys","key","MODAL_ELEM","MODAL_FORM_ELEM","MODAL_CLOSE_BUTTON_ELEM","initDomElements","insertAdjacentHTML","modalTemplateString","getTemplateString","dataEvent","eventName","find","eventValue","innerText","isOpenable","clear","location","reload","MODAL_ELEM_CLASS","modalElemForm","MODAL_ELEM_FORM_CLASS","modalElemCloseButton","MODAL_ELEM_CLOSE_BUTTON_CLASS","closest","emailInputElement","currentTarget","email","keyCode","contains","initModal","triggerOptions","getTriggerOptions","every","triggerOptionKey","initModalDataWatchers","add","focusableElements","focusableElementsInModal","focusableElementsInModalArray","includes","children","concat","targetTouches","clientY","scrollTop","isTargetElementTotallyScrolled","stopPropagation","handleScroll","_lock","disableBodyScroll","openModal","mouseNearTopOfPage","mouseDidntEnterAnotherElement","relatedTarget","mouseEventIsNotInsideAnInputElement","nodeName","toLowerCase","readyState","contentWebsite","marketingWebsite"],"mappings":"+LAAe,GCAXA,EAAQ,GAEZ,SAAwBC,EAASC,GAC/B,OAAOF,EAAME,IAAaC,SAASC,cAAcF,GCAnDG,OAAOC,iBAAmBA,ECH1B,IAAIC,EAAEC,EAAEC,EAAEC,OAAOC,UAAUC,EAAEC,SAASF,UAAUG,SAASC,EAAEN,EAAEO,eAAeC,EAAEL,EAAEM,KAAKR,QAAQS,EAAEV,EAAEK,SAASM,GAAGb,EAAEG,OAAOW,eAAeb,EAAEE,OAAO,SAASD,GAAG,OAAOF,EAAEC,EAAEC,MAAM,SAASa,EAAEf,EAAEC,IAAI,MAAMA,GAAGA,EAAED,EAAEgB,UAAUf,EAAED,EAAEgB,QAAQ,IAAI,IAAId,EAAE,EAAEG,EAAE,IAAIY,MAAMhB,GAAGC,EAAED,EAAEC,IAAIG,EAAEH,GAAGF,EAAEE,GAAG,OAAOG,EAAE,SAASa,EAAElB,EAAEC,GAAG,IAAIC,EAAE,GAAG,oBAAoBiB,QAAQ,MAAMnB,EAAEmB,OAAOC,UAAU,CAAC,GAAGH,MAAMI,QAAQrB,KAAKE,EAAE,SAASF,EAAEC,GAAG,GAAGD,EAAE,CAAC,GAAG,iBAAiBA,EAAE,OAAOe,EAAEf,OAAE,GAAQ,IAAIE,EAAEC,OAAOC,UAAUG,SAASI,KAAKX,GAAGsB,MAAM,GAAG,GAAG,MAAM,WAAWpB,GAAGF,EAAEuB,cAAcrB,EAAEF,EAAEuB,YAAYC,MAAM,QAAQtB,GAAG,QAAQA,EAAEe,MAAMQ,KAAKzB,GAAG,cAAcE,GAAG,2CAA2CwB,KAAKxB,GAAGa,EAAEf,OAAE,QAAQ,GAA9R,CAAuSA,KAAKC,GAAGD,GAAG,iBAAiBA,EAAEgB,OAAO,CAACd,IAAIF,EAAEE,GAAG,IAAIG,EAAE,EAAE,OAAO,WAAW,OAAOA,GAAGL,EAAEgB,OAAO,CAACW,MAAK,GAAI,CAACA,MAAK,EAAGC,MAAM5B,EAAEK,OAAO,MAAM,IAAIwB,UAAU,yIAAyI,OAAO3B,EAAEF,EAAEmB,OAAOC,aAAaU,KAAKC,KAAK7B,GAAG,SAAS8B,IAAIC,KAAKC,gBAAgB,GAAGF,EAAE5B,UAAU,CAAC+B,KAAK,SAASnC,EAAEC,GAAG,IAAI,IAAIC,EAAEG,EAAE4B,KAAKC,gBAAgB,MAAM,GAAG1B,EAAEU,EAAEe,KAAKC,gBAAgBlC,IAAI,MAAME,EAAEM,KAAKmB,OAAM,EAAGzB,EAAE0B,OAAO,CAACJ,KAAKxB,EAAE4B,MAAM3B,IAAI,IAAI,IAAIS,EAAEE,EAAEM,EAAEb,KAAKK,EAAEE,KAAKe,OAAM,EAAGjB,EAAEkB,OAAO,CAACJ,KAAKxB,EAAE4B,MAAM3B,KAAKmC,GAAG,SAASpC,EAAEC,GAAG,IAAI,IAAIC,EAAEG,EAAEa,EAAED,MAAMI,QAAQrB,GAAGA,EAAE,CAACA,MAAME,EAAEG,KAAKsB,MAAM,CAAC,IAAInB,EAAEN,EAAE0B,MAAMK,KAAKC,gBAAgB1B,KAAKyB,KAAKC,gBAAgB1B,GAAG,IAAIyB,KAAKC,gBAAgB1B,GAAG6B,KAAKpC,MAAM,IAAIqC,EAAE,IAAIN,EAAE,SAASO,EAAEvC,EAAEC,QAAG,IAASA,IAAIA,EAAE,IAAID,EAAEA,GAAG,YAAY,IAAIE,EAAED,EAAEuC,SAASzB,OAAE,IAASb,EAAE,GAAGA,EAAEgB,EAAEuB,KAAKC,MAAMC,aAAaC,QAAQ5C,IAAI,KAAK6C,GAAG,OAAO3B,EAAEf,OAAO2C,OAAO/B,EAAEG,GAAG,IAAI6B,MAAM7B,EAAE,SAASjB,EAAEC,GAAG,MAAM,CAAC8C,IAAI,SAAShD,EAAEK,GAAG,OAAO4C,EAAEjD,EAAEK,IAAI,IAAI0C,MAAM/C,EAAEK,GAAGJ,EAAEC,IAAIF,EAAEK,IAAI6C,IAAI,SAASjD,EAAEc,EAAEG,GAAGjB,EAAEc,GAAGG,EAAEyB,aAAaQ,QAAQnD,EAAEyC,KAAKW,UAAUlD,EAAEmD,IAAI,IAAIrB,EAAE/B,EAAEc,GAAGwB,EAAEU,EAAEjB,GAAGS,KAAKC,MAAMD,KAAKW,UAAUpB,EAAEqB,GAAGR,GAAGb,EAAEsB,EAAEL,EAAE/B,GAAGuB,KAAKC,MAAMD,KAAKW,UAAUlC,EAAEmC,GAAGR,GAAG3B,EAAEqC,EAAE,SAASvD,EAAEC,GAAG,GAAGD,IAAIC,EAAE,MAAM,GAAG,IAAIC,EAAE,GAAG,OAAO,SAASF,EAAEC,EAAEC,EAAEa,GAAGA,EAAEA,GAAG,GAAGE,MAAMI,QAAQpB,GAAG,SAASA,EAAEC,EAAEG,GAAGJ,EAAEuD,QAAQ,CAACvD,EAAEO,EAAEE,KAAK,MAAME,EAAE,GAAGP,KAAKG,KAAKN,EAAES,KAAKD,EAAET,EAAEO,EAAEE,EAAEE,GAAGZ,EAAEU,EAAEF,GAAGN,EAAEU,KAApF,CAA0FX,EAAEC,EAAEa,GAAG,SAASf,GAAG,IAAI,SAASA,GAAG,QAAQA,GAAG,iBAAiBA,EAAxC,CAA2CA,IAAI,mBAAmBY,EAAED,KAAKX,IAAI,SAASA,GAAG,IAAIC,GAAE,EAAG,GAAG,MAAMD,GAAG,mBAAmBA,EAAEO,SAAS,IAAIN,KAAKD,EAAE,IAAI,MAAMA,IAAI,OAAOC,EAA/F,CAAkGD,GAAG,OAAM,EAAG,IAAIC,EAAEY,EAAEb,GAAG,GAAG,OAAOC,EAAE,OAAM,EAAG,IAAIC,EAAEM,EAAEG,KAAKV,EAAE,gBAAgBA,EAAEsB,YAAY,MAAM,mBAAmBrB,GAAGA,aAAaA,GAAGG,EAAEM,KAAKT,IAAIQ,EAA/U,CAAkVT,IAAI,SAASA,EAAEC,EAAEG,GAAG,IAAI,MAAMG,KAAKP,EAAE,CAAC,MAAMS,EAAEL,EAAE,GAAGA,KAAKG,IAAIA,EAAEN,EAAES,KAAKV,EAAEA,EAAEO,GAAGA,EAAEP,EAAES,GAAGV,EAAEC,EAAEO,GAAGN,EAAEQ,IAAxF,CAA6FT,EAAEC,EAAEa,GAAnkB,CAAukBf,EAAE,SAASA,EAAEK,EAAEG,EAAEE,GAAGV,IAAIC,IAAIC,EAAEQ,KAAKR,EAA1pB,CAA6pBA,EAAEgB,IAAIH,EAAE,OAAOuB,EAAEH,KAAKoB,EAAE,CAACE,KAAK1C,EAAE2C,KAAKH,EAAEI,SAASpB,EAAEX,MAAM0B,KAAI,IAAp9B,CAA09BpC,IAAI,SAAS+B,EAAEjD,GAAG,MAAM,iBAAiBA,GAAG,OAAOA,KAAKA,aAAa4D,MAAM,SAASP,EAAErD,EAAEC,GAAG,GAAGgC,KAAKjC,aAAa4D,KAAK,CAAC,IAAI1D,EAAE+B,KAAKjC,GAAG6D,UAAU,OAAO3D,EAAE,CAAC4D,UAAS,EAAGC,GAAG7D,QAAG,EAAO,OAAOD,EAAE,SAAS4C,EAAE7C,EAAEC,GAAG,OAAOA,EAAE6D,SAAS,IAAIF,KAAK3D,EAAE8D,IAAI9D,ECClxF,SAASiD,EAAKc,EAAUC,GACtB,IAAIC,EAAiBvB,aAAaC,QAAQ,8BACtCuB,EAAiBD,EAAiBzB,KAAKC,MAAMwB,GAAkB,GAGnE,OAFAC,EAAeH,GAAYC,EAC3BtB,aAAaQ,QAAQ,6BAA8BV,KAAKW,UAAUe,IAC3DF,EAGT,SAASjB,EAAKgB,GAGZ,OAFqBrB,aAAaC,QAAQ,8BACJH,KAAKC,MAAMC,aAAaC,QAAQ,+BAAiC,IACjFoB,GDZ4vFzB,EAAEH,GAAG,SAASpC,EAAEC,GAAGqC,EAAEF,GAAGpC,EAAE,SAASA,GAAGC,EAAED,EAAE4B,UEEpyFwC,EAAU,sBDoBpC,MAAe,CACblB,IAAAA,EACAF,IAAAA,EACAqB,UAVF,SAAoBL,GAClB,IAAIM,EAAMtB,EAAIgB,IAAa,EAG3B,OADAd,EAAIc,IADJM,GAEOA,MEnBT,SAAkB9C,EAAMI,GACtB,IAAI2C,EAAQ,IAAIC,YAAYhD,EAAM,CAAEiD,OAAQ7C,IAC5ChC,SAAS8E,cAAcH,MAGzB,SAAiB/C,EAAMmD,GACrB/E,SAASgF,iBAAiBpD,EAAM,SAAU+C,GACxCI,EAAGJ,EAAME,UACR,MCLU,CACbI,cAAe,CACbC,QAAS,UACTC,UAAW,aAEbC,oBAAqB,wHACrBC,UAAWnF,OAAOoF,WAAW,sCAAsCC,QACnEC,oBAAqB,eACrBC,yBAA0B,wBAC1BC,iCAAkC,sBAClCC,sBAAuB,sBACvBC,mBAAmB,EACnBC,gBAAiB,EACjBC,0BAA2B,EAC3BC,oBAAqB,EACrBC,oBAAqB,EAOrBC,0BAAkBC,GAChB7D,KAAK8D,cAAgBD,GAEvBE,4BACE,YAAYD,eAEdE,8BACEhE,KAAKuD,mBAAoB,EACzBU,EAAmB,qBAAqB,IAE1CC,2BACE,YAAYX,mBAEdY,sCACE,YAAYV,2BAEdW,+BACE,YAAYV,qBAEdW,+BACE,YAAYV,qBAEdW,kCACE,IAAIC,EAAYC,EAAGpC,UAAU,aAC7BpC,KAAKwD,gBAAkBe,EAEvBN,EAAmB,WAAY,CAACM,UAAAA,KAElCE,oCAA4BpC,GAC1B,IAAIqC,EAAwBF,EAAGzD,IAAI,4BAA8B,EAE7D4D,EAA0BtC,EAAMqC,EAAwBrC,EAAMqC,EAElEF,EAAGvD,IAAI,0BAA2B0D,GAClC3E,KAAKyD,0BAA4BkB,EAEjCV,EAAmB,WAAY,CAACU,wBAAAA,KAElCC,mCAA2BC,GACzB,IAAIC,EAAmBN,EAAGpC,UAAU,oBACpCpC,KAAK0D,oBAAsBoB,EAE3Bb,EAAmB,WAAY,CAACa,iBAAAA,KAElCC,mCAA2BF,GACzB7E,KAAK2D,qBAAuB,EAC5BM,EAAmB,WAAY,CAACe,iBAAkBhF,KAAK2D,wBC3DvDsB,ECZJ,SAAWjH,EAAED,GAAG,IAAIY,GAAE,EAAGJ,GAAE,EAAG,OAAO,WAAW,IAAIO,EAAEoG,UAAU3G,IAAIA,GAAE,EAAG4G,WAAW,WDYjC,ICZ8CC,WAAM,EAAO,GAAG/F,MAAMX,KAAKI,IAAIP,GAAE,GAAII,EAAE,EAAEZ,GAAGY,GAAE,IDYrG0G,CAAS,EAAM,eAPnDC,EAEAC,EASJC,EAAQf,4BAXJa,EAAkBG,KAAKC,IAAI/H,SAASgI,KAAKC,aAAcjI,SAASkI,gBAAgBD,aAAcjI,SAASgI,KAAKG,aAAcnI,SAASkI,gBAAgBC,aAAcnI,SAASgI,KAAKI,aAAcpI,SAASkI,gBAAgBE,cAEtNR,EAAmB1H,OAAOmI,aAAeV,EAAkB3H,SAASkI,gBAAgBE,cAEjFN,KAAKQ,MAAyB,IAAnBV,KAQlBC,EAAQZ,4BACRY,EAAQT,8BElBV,SAASmB,EAAmBC,GAAO,GAAInH,MAAMI,QAAQ+G,GAAM,CAAE,IAAK,IAAIxH,EAAI,EAAGyH,EAAOpH,MAAMmH,EAAIpH,QAASJ,EAAIwH,EAAIpH,OAAQJ,IAAOyH,EAAKzH,GAAKwH,EAAIxH,GAAM,OAAOyH,EAAe,OAAOpH,MAAMQ,KAAK2G,GAO1L,IAAIE,GAAmB,EACvB,GAAsB,oBAAXxI,OAAwB,CACjC,IAAIyI,EAAqB,CACvBC,cACEF,GAAmB,IAIvBxI,OAAO8E,iBAAiB,cAAe,KAAM2D,GAC7CzI,OAAO2I,oBAAoB,cAAe,KAAMF,GAGlD,IAAIG,EAAgC,oBAAX5I,QAA0BA,OAAO6I,WAAa7I,OAAO6I,UAAUC,WAAa,iBAAiBlH,KAAK5B,OAAO6I,UAAUC,WAA2C,aAA9B9I,OAAO6I,UAAUC,UAA2B9I,OAAO6I,UAAUE,eAAiB,GAGnOC,EAAQ,GACRC,GAAwB,EACxBC,GAAkB,EAClBC,OAA8B,EAC9BC,OAA2B,EAG3BC,EAAiB,SAAwBrD,GAC3C,OAAOgD,EAAMM,KAAK,SAAUC,GAC1B,SAAIA,EAAKC,QAAQH,iBAAkBE,EAAKC,QAAQH,eAAerD,OAQ/DyD,EAAiB,SAAwBC,GAC3C,IAAInJ,EAAImJ,GAAY1J,OAAOyE,MAM3B,QAAI4E,EAAe9I,EAAEoJ,SAKjBpJ,EAAEqJ,QAAQ1I,OAAS,IAEnBX,EAAEkJ,gBAAgBlJ,EAAEkJ,kBAEjB,aCpDeI,IACtB/J,SAASgI,KAAKgC,UAAUC,OAAOpC,EAAQlC,uBAMvCkC,EAAQqC,UAAUC,MAAMC,QAAU,OAGRpK,SAASqK,iBAAiBxC,EAAQzC,qBAC1CxB,QAAQ,SAAAsC,UAAMA,EAAGoE,gBAAgB,cAG1BtK,SAASqK,iBAAiB,wBAClCzG,QAAQ,SAAAsC,UAAMA,EAAGoE,gBAAgB,iBAClDzC,EAAQqC,UAAUK,aAAa,cAAe,QAG9C,IAAIpE,EAAgB0B,EAAQzB,mBACxBD,GACFA,EAAcqE,QDiLY,SAA0BC,GACtD,GAAI3B,EAAa,CACf,IAAK2B,EAGH,YADAC,QAAQC,MAAM,gHAIhBF,EAAcG,aAAe,KAC7BH,EAAcI,YAAc,KAE5B3B,EAAQA,EAAM4B,OAAO,SAAUrB,GAC7B,OAAOA,EAAKgB,gBAAkBA,IAG5BtB,GAA0C,IAAjBD,EAAM9H,SACjCpB,SAAS6I,oBAAoB,YAAac,EAAgBjB,EAAmB,CAAEE,SAAS,QAAUmC,GAElG5B,GAAwB,QAG1BD,EAAQA,EAAM4B,OAAO,SAAUrB,GAC7B,OAAOA,EAAKgB,gBAAkBA,KAErBrJ,QA7IboG,WAAW,gBACwBuD,IAA7BzB,IACFtJ,SAASgI,KAAKmC,MAAMa,aAAe1B,EAInCA,OAA2ByB,QAGOA,IAAhC1B,IACFrJ,SAASgI,KAAKmC,MAAMc,SAAW5B,EAI/BA,OAA8B0B,KCvElCG,CAAiBrD,EAAQqC,WCzB3B,IAAMiB,EAAsB,CAAC,YAAa,0BAA2B,mBAAoB,oBACnFC,EAAuB,CAC3BxE,UAAW,GACXI,wBAAyB,IACzBG,iBAAkB,IAClBE,iBAAkB,cCUIgE,SCjBSC,MDkB/BC,gBAAAA,gBACAC,IAAAA,gBACAC,yBAAAA,oBACAC,SAAAA,aAAW,mBACXC,SAAAA,aAAW,SACXC,YAAAA,aAAc,4BACdC,gBAAAA,aAAkB,gEAClBC,eAAAA,aAAiB,gBACjBC,gBAAAA,aAAkB,UAGlBrB,QAAQsB,IAAI,QC7BmBV,ED+BtB,eXpBmCW,EaARC,EbAQD,EWsBrB,CAACV,gBAAAA,EAAiBC,YAAAA,EAAaC,yBAAAA,EAA0BE,SAAAA,EAAUC,YAAAA,EAAaC,gBAAAA,EAAiBC,eAAAA,EAAgBC,gBAAAA,GXrBxIrB,QAAQsB,IAAI,kBACZzL,OAAO4L,KAAKF,GAAoBrI,QAAQ,SAAAwI,GACtCjM,EAAiBiM,GAAOH,EAAmBG,KAG7C7L,OAAO2C,OAAO/C,EAAkB,CAC9B8E,cAAe,CACbC,QAAS,UACTC,UAAW,aAEbE,UAAWnF,OAAOoF,WAAW,sCAAsCC,QACnEH,oBAAqB,wHACrBO,sBAAuB,sBACvB0G,WAAYvM,EAnBO,gBAoBnBwM,gBAAiBxM,EAnBO,yBAoBxByM,wBAAyBzM,EAnBO,yCcLuB6L,QHiCvDa,GGjCuDb,SAAUC,QHiCjEY,GGjCiEZ,YAAaC,QHiC9EW,GGjC8EX,gBAAiBC,QHiC/FU,GGjC+FV,qBHiC/FU,GGjCsCjB,iBC0BxCvL,SAASgI,KAAKyE,mBAAmB,i2BDpBjC,IAAIC,EAAsBC,kBAAkB,CAAChB,SAAAA,EAAUC,YAAAA,EAAaC,gBAAAA,EAAiBC,eAAAA,IACrF9L,SAASgI,KAAKyE,mBAAmB,YAAaC,GH0B5CF,GAKIjB,ID5BNjF,EAAkB,WAAY,SAAUsG,GACtC,IAAIC,EAAY1B,EAAoB2B,KAAK,SAAAlL,UAAQgL,EAAU/L,eAAee,KACtEmL,EAAaH,EAAUC,GAAazB,EAAqByB,GAErC7M,SAASC,uDAAuD4M,QACtEG,UAAYD,IAGhCzG,EAAkB,oBAAqB,SAAU2G,GACvBjN,SAASC,yEACf+M,UAAYC,EAAa,OAAS,UAItDjN,SAASC,cAAc,8BAA8B+E,iBAAiB,QAAS,SAAAvE,GAC7EP,OAAO6C,aAAamK,QACpBhN,OAAOiN,SAASC,4BM1BgB1B,IAAAA,SAElC7D,QAAQqC,UAAYlK,SAASC,cAAc4H,QAAQwF,kBACnDxF,QAAQyF,cAAgBtN,SAASC,cAAc4H,QAAQ0F,uBACvD1F,QAAQ2F,qBAAuBxN,SAASC,cAAc4H,QAAQ4F,+BAG9D5F,QAAQ6D,SAAWA,ECNnB7D,EAAQqC,UAAUlF,iBAAiB,QAAS,SAAAL,IAA8B,CAACA,MAAAA,IAuB7CA,MACnBkF,OAAO6D,QAAQ7F,EAAQ0F,wBAChCxD,MAxBFlC,EAAQyF,cAActI,iBAAiB,SAAU,SAAAL,UAWnD,gBAAoBA,IAAAA,MAClBA,EAAMgF,iBAGN,IAAIgE,EAAoBhJ,EAAMiJ,cAAc3N,cAAc,4BAE1D4H,EAAQ6D,SAAS,CAAC/G,MAAAA,EAAOkJ,MADbF,EAAkB3L,QAG9B+H,IAnB0D2B,CAAS,CAAC/G,MAAAA,MACpEkD,EAAQ2F,qBAAqBxI,iBAAiB,QAAS,kBAAM+E,MAC7D/J,SAASgF,iBAAiB,UAAW,SAACL,GAIhB,KAJoC,CAACA,MAAAA,GAGxCA,MACTmJ,SAAkB9N,SAASgI,KAAKgC,UAAU+D,SAASlG,EAAQlC,wBACnEoE,MNkCAiE,CAAU,CAACtC,SAAAA,EAAUC,SAAAA,EAAUC,YAAAA,EAAaC,gBAAAA,EAAiBC,eAAAA,ILxB/DjE,EAAQlB,yBAERzG,OAAO8E,iBAAiB,SAAUsC,mBYpBYkE,IAAAA,YAAaC,IAAAA,yBAC3DnF,EAAkB,WAAY,SAAUsG,GACtC,IAAIqB,kBCJkBzC,IAAAA,YAAaC,IAAAA,yBACrC,OAAID,IAAgB3D,EAAQ5C,cAAcC,QACnCuG,EASI,CACLzF,oBAAqB,EACrBD,oBAAqB,GACrBD,0BAA2B,IAVtB,CACLE,oBAAqB,EACrBD,oBAAqB,GACrBD,0BAA2B,IAUtB0F,IAAgB3D,EAAQ5C,cAAcE,UAC1CsG,EASI,CACLzF,oBAAqB,EACrBH,gBAAiB,EACjBE,oBAAqB,IAVhB,CACLC,oBAAqB,EACrBH,gBAAiB,EACjBE,oBAAqB,WDnBJmI,CAAkB,CAAC1C,YAAAA,EAAaC,yBAAAA,IAE/BlL,OAAO4L,KAAK8B,GAAgBE,MAAM,SAAAC,GAItD,OAFkBvG,EAAQuG,IADXH,EAAeG,MAO9BvG,EAAQxB,uBPoCVgI,CAAsB,CAAC7C,YAAAA,EAAaC,yBAAAA,IEzCFS,EF2CrB,WACPrE,EAAQtB,8BSnDhBsB,EAAQ5B,iBAAiBjG,SAASmG,eAGlC0B,EAAQqC,UAAUC,MAAMC,QAAU,OAClCpK,SAASgI,KAAKgC,UAAUsE,IAAIzG,EAAQlC,uBAGpCkC,EAAQqC,UAAUjK,cAAc4H,EAAQzC,qBAAqBoF,QAI7D,IAAM+D,EAAoBvO,SAASqK,iBAAiBxC,EAAQzC,qBACtDoJ,EAA2B3G,EAAQqC,UAAUG,iBAAiBxC,EAAQzC,qBACtEqJ,EAAgCpN,MAAMQ,KAAK2M,GACjDD,EAAkB3K,QAAQ,SAAAsC,GACnBuI,EAA8BC,SAASxI,IAC1CA,EAAGqE,aAAa,WAAY,QAKhC1C,EAAQqC,UAAUI,gBAAgB,eACTjJ,MAAMQ,KAAK7B,SAASgI,KAAK2G,UACjC/K,QAAQ,SAAAsC,GACnBA,IAAO2B,EAAQqC,WACjBhE,EAAGqE,aAAa,cAAe,UZoGN,SAA2BE,EAAef,GACvE,GAAIZ,EAAa,CAGf,IAAK2B,EAGH,YADAC,QAAQC,MAAM,kHAIhB,GAAIF,IAAkBvB,EAAMM,KAAK,SAAUC,GACzC,OAAOA,EAAKgB,gBAAkBA,IAC5B,CACF,IAAIhB,EAAO,CACTgB,cAAeA,EACff,QAAoB,IAGtBR,EAAQ,GAAG0F,OAAOrG,EAAmBW,GAAQ,CAACO,IAE9CgB,EAAcG,aAAe,SAAUjG,GACF,IAA/BA,EAAMkK,cAAczN,SAEtBgI,EAAiBzE,EAAMkK,cAAc,GAAGC,UAG5CrE,EAAcI,YAAc,SAAUlG,GACD,IAA/BA,EAAMkK,cAAczN,QAhDb,SAAsBuD,EAAO8F,GAC9C,IAAIqE,EAAUnK,EAAMkK,cAAc,GAAGC,QAAU1F,GAE3CG,EAAe5E,EAAMkF,UAIrBY,GAA6C,IAA5BA,EAAcsE,WAAmBD,EAAU,GAX7B,SAAwCrE,GAC3E,QAAOA,GAAgBA,EAAcxC,aAAewC,EAAcsE,WAAatE,EAAcrC,aAezF4G,CAA+BvE,IAAkBqE,EAAU,EAHtDnF,EAAehF,GAQxBA,EAAMsK,mBAiCEC,CAAavK,EAAO8F,IAInBtB,IACHnJ,SAASgF,iBAAiB,YAAa2E,EAAgBjB,EAAmB,CAAEE,SAAS,QAAUmC,GAC/F5B,GAAwB,QAGvB,CA1GP3B,WAAW,gBAEwBuD,IAA7BzB,IAEiBpJ,OAAoBF,eASL+K,IAAhC1B,IACFA,EAA8BrJ,SAASgI,KAAKmC,MAAMc,SAClDjL,SAASgI,KAAKmC,MAAMc,SAAW,YA6FjC,IAAIkE,EAAQ,CACV1E,cAAeA,EACff,QAAoB,IAGtBR,EAAQ,GAAG0F,OAAOrG,EAAmBW,GAAQ,CAACiG,KY7IhDC,CAAkBvH,EAAQqC,WTuBpBmF,IEhCNrP,SAASgF,iBAAiB,WAZ1B,SAAoBL,GAClB,IAAI2K,EAAqB3K,EAAMmK,QAAU,GACrCS,EAAwD,OAAxB5K,EAAM6K,cACtCC,EAA8E,WAAxC9K,EAAMkF,OAAO6F,SAASC,eAAsE,UAAxChL,EAAMkF,OAAO6F,SAASC,cAEhHL,GAAsBC,GAAiCE,GAErDvD,GACFA,ODnBqB,WAAvBlM,SAAS4P,WACXtE,IAEAtL,SAASgF,iBAAiB,mBAAoBsG,SSSnC,CACbuE,wBAXuBnG,GACvBA,EAAQ8B,YAAc3D,EAAQ5C,cAAcC,QAC5CmG,EAAe3B,IAUfoG,iBAPF,SAA2BpG,GACzBA,EAAQ8B,YAAc3D,EAAQ5C,cAAcE,UAC5CkG,EAAe3B"}